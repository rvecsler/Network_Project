<!DOCTYPE html>
<html lang="en">
<head>
	<title>Mapping with D3</title>
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="mappingdata.json"></script>
    <script src="spaths.json"></script>
    <script src="nyc-zip.json"></script>
	<link href="http://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">

 <style>
body {
   
    font-family: "Proxima Nova", "Montserrat", sans-serif;
}
     
#info {
    display:inline-block;
    float: right;
    min-height = 580;
    position:relative;
    
     }
#svg {display:inline-block;
     }
     
h1, h2 {
    position: absolute;
    left: 10px;
    font-size: 1.3em;
    font-weight: 100;
}
     
h2 {
    top: 30px;
    font-size: 1em;
    color: steelblue;
}
     
.st_point {
    fill: steelblue;
}
     
.hover {
    fill: yellow;   
}

.path_st {
    fill: green;
    stroke: green;
    color: green;
     }
     
.mpath_st {
    fill: orange;
    stroke: orange;
    color: orange;
     }
     
.rem_st {
    fill: black;
    stroke: black;
    color: black;
     }
     
.tar_st, .src_st {
    fill: red;
    stroke: red;
    color: red;
}
     
.src_st {
    fill: blue;
    stroke: blue;
    color: blue;
}
     
.cur_sel {
    fill: steelblue;
    stroke: steelblue;
    color: steelblue;
}
     
.dropdown {
    margin: 50px;
    padding:20x;
    display:block;
    float:right;
    width: 300px;
    height: 100px;
     }
     
    </style>

</head>
<body>
    <h1>NYC Subway System</h1>
    <h2></h2>
    <div>
        <div id="svg"></div>
        <div id="info"><h3>Shortest Path from Source to Target Station</h3></div>
    </div>
    <div id="user_selections">
        <div id = "target_station" class = "dropdown">
            <h3>Target Station</h3>  
        </div> 
        <div id = "source_station" class = "dropdown">
            <h3>Source Station</h3>  
        </div>  
        <div id = "removed_station" class = "dropdown">
            <h3>Station to Remove</h3>  
        </div> 
    </div>
    <script>

    //add the user paramters_____________________________
    
        
     
        
    //target station selection
     var selectt = d3.select('#target_station')
    .append('select')
  	 .attr('class','selectt')
        .on('change',ontchange)
        

    var optiont = selectt
    .selectAll('option')
    .data(stations_json.features).enter()
	   .append('option')
		.attr('value', function (d) { return d.properties.station_id; })
		.attr('label',function(d) { return [d.properties.name + " : " + d.properties.line];});
        
    
    //source station selection
    var selects = d3.select('#source_station')
    .append('select')
  	 .attr('class','selects')
        .on('change',onschange)
        

    var options = selects
    .selectAll('option')
    .data(stations_json.features).enter()
	   .append('option')
        .attr('value', function (d) { return d.properties.station_id; })
		.attr('label',function(d) { return [d.properties.name + " : " + d.properties.line];});
    
   

    //clear selection
    var clearb = d3.select("#user_selections")  
    .append("input")
        .attr("type", "button")
        .attr("name", "clear selections")
        .attr("value", "Clear Selections")
        .attr("onclick", "togglePressed()"); 
        
        //removed node selection
    var selectr = d3.select('#removed_station')
    .append('select')
  	 .attr('class','selectr')
        .on('change',onrchange)
        

    var options = selectr
    .selectAll('option')
    .data(stations_json.features).enter()
	   .append('option')
        .attr('value', function (d) { return d.properties.station_id; })
		.attr('label',function(d) { return [d.properties.name + " : " + d.properties.line];});
        
//svg map and points________________________________
    var width = 700;
    var height = 580;
    
    var svg = d3.select( "#svg" )
        .append( "svg" )
        .attr( "width", width )
        .attr( "height", height );
   
    var g = svg.append( "g" );
    
    var albersProjection = d3.geoAlbers()
        .scale( 80000 )
        .rotate( [74.0059,0] )
        .center( [0, 40.7128] )
        .translate( [width/2,height/2] );
    
    var geoPath = d3.geoPath()
        .projection( albersProjection );
    g.selectAll( "path" )
        .data( zipcodes_json.features )
        .enter()
        .append( "path" )
        .attr( "fill", "#efefef" )
        .attr( "stroke", "#ccc")
        .attr( "d", geoPath );
    
    var stations = svg.append( "g" );
    stations.selectAll( "path" )
        .data( stations_json.features )
        .enter()
        .append( "path" )
        .attr( "fill", "#900" )
        .attr( "stroke", "#999" )
        .attr( "d", geoPath )
        .attr("class",function(d) { return "id_"+d.properties.station_id + " st_point";})
        .style("fill-opacity", 0.5)
        .on("mouseover", function(d){
            d3.select("h2").text(d.properties.name + " : " + d.properties.line);
            d3.select(this).attr("class","id_"+ d.properties.station_id+ " st_point hover");
        })
        .on("mouseout", function(d){
            d3.select("h2").text("");
            d3.select(this).attr("class",function(d) { return "id_"+d.properties.station_id + " st_point";});
        });
        
        
//On user selection change____________________________
function path_nodes(paths,i){
    d3.select("#info")
    .selectAll("p")
        .data(paths)
        .enter().append("p")
            .text(function(paths) { i+=i; return paths;})
    paths.forEach(function(d) { d3.select(".id_"+d).attr("class","path_st id_"+d );});
 
};

function mpath_nodes(paths,i){
    d3.select("#info")
    .selectAll("p")
        .data(paths)
        .enter().append("p")
            .text(function(paths) { i+=i; return paths;})
    paths.forEach(function(d) { d3.select(".id_"+d).attr("class","mpath_st id_"+d );});
 
};

function onschange() {
	var selectSource= selects.property('value')
	d3.select('#source_station')
		.selectAll('p')
        .remove();
    d3.select('#source_station')
        .append('p')
            .attr("class","cur_sel")
            .text(selectSource + ' is the last selected source station.');
    d3.select(".id_"+selectSource)
        .attr("class","src_st id_"+selectSource +" st_point");
    
        
};
        

        
function ontchange() {
	var selectTarget = selectt.property('value');
     var selectSource= selects.property('value');
	d3.select('#target_station')
		.selectAll('p')
        .remove();
    d3.select('#target_station')
        .append('p')
        .attr("class","cur_sel")
		.text(selectTarget + ' is the last selected target station.');
    d3.select(".id_"+selectTarget)
        .attr("class","tar_st id_"+selectTarget +" st_point")
        ;
    var shortPathData = spaths_json.features.filter(function(d) { return d.source.includes(selectSource)&&d.target.includes(selectTarget) ;});
    
    path_nodes(shortPathData[0].shortpath,1)
    
    
    
};
    

        
function onrchange() {
	var selectRemoval = selectr.property('value');
    var selectTarget = selectt.property('value');
    var selectSource= selects.property('value');
	d3.select('#removed_station')
		.selectAll('p')
        .remove();
    d3.select('#removed_station')
        .append('p')
        .attr("class","cur_sel")
		.text(selectRemoval + ' is the station removed from the network.');
    d3.select(".id_"+selectRemoval)
        .attr("class","rem_st id_"+selectRemoval +" st_point");   
    
    var shortPathData = spaths_json.features.filter(function(d) { return d.source.includes(selectSource)&&d.target.includes(selectTarget) ;});
    
    mpath_nodes(shortPathData[0].shortpath,1)
     
};
        


function togglePressed(){
    var selectTarget = selectt.property('value');
    var selectSource= selects.property('value');
    var selectRemoval = selectr.property('value');
    
    
        d3.select(".tar_st")
            .attr("class","id_"+selectTarget +" st_point");
    
        d3.select(".src_st")
            .attr("class","id_"+selectSource +" st_point");
    
        d3.select(".rem_st")
            .attr("class","id_"+selectRemoval +" st_point");
        
        d3.select('#target_station')
        .selectAll('p')
        .remove();
        
        d3.select('#source_station')
        .selectAll('p')
        .remove();
    
        d3.select('#removed_station')
        .selectAll('p')
        .remove();
    
     d3.select('#info')
        .selectAll('p')
        .remove();
};
        
        
    </script>
</body>
</html>